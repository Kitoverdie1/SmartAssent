import streamlit as st
import pandas as pd
from pathlib import Path

# ==============================
# 1) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
# ==============================
st.set_page_config(
    page_title="Smart Asset QR ‚Äì Detail from Excel",
    page_icon="ü©∫",
    layout="wide",
)

# ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö app.py
BASE_DIR = Path(__file__).resolve().parent

# ‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏•‡∏±‡∏Å
EXCEL_PATH = BASE_DIR / "Smart Asset Lab.xlsx"

# ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô Excel (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏£‡∏¥‡∏á)
COL_CODE = "‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£"  # ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô key ‡∏à‡∏≤‡∏Å QR
COL_IMAGE = "‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"                         # ‡πÄ‡∏Å‡πá‡∏ö path ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û

# ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
IMAGE_FOLDER = BASE_DIR / "asset_images"


# ==============================
# 2) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î / ‡πÄ‡∏ã‡∏ü Excel
# ==============================
@st.cache_data
def load_data() -> pd.DataFrame:
    """‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ DataFrame"""
    if not EXCEL_PATH.exists():
        raise FileNotFoundError(f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå Excel: {EXCEL_PATH.name}")
    df = pd.read_excel(EXCEL_PATH).dropna(how="all").reset_index(drop=True)
    return df


def save_data(df: pd.DataFrame):
    """‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å DataFrame ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà Excel ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå cache"""
    df.to_excel(EXCEL_PATH, index=False)
    load_data.clear()


# ==============================
# 3) ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å code ‡πÉ‡∏ô URL
# ==============================
def render_asset_from_query() -> bool:
    """
    ‡∏ñ‡πâ‡∏≤ URL ‡∏°‡∏µ ?code=LAB-AS-001 ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel
    ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô Excel
    """
    # 3.1 ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ code ‡∏à‡∏≤‡∏Å URL (?code=XXXX)
    params = st.experimental_get_query_params()
    code = params.get("code", [None])[0]

    if not code:
        # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ code ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å QR ‚Üí ‡πÉ‡∏´‡πâ main ‡πÑ‡∏õ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏ó‡∏ô
        return False

    st.markdown("## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet / Excel")
    st.caption(f"‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å URL: `{code}`")

    # 3.2 ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel
    try:
        df = load_data()
    except Exception as e:
        st.error(f"‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: {e}")
        return True

    # 3.3 ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏´‡∏≤ row ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏°
    if COL_CODE not in df.columns:
        st.error(f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `{COL_CODE}` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel")
        return True

    # 3.4 ‡∏´‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö code
    match_idx = df[df[COL_CODE].astype(str) == str(code)].index
    if len(match_idx) == 0:
        st.warning(f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™ `{code}` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel")
        return True

    row_idx = match_idx[0]   # index ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
    row = df.loc[row_idx]    # Series ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô

    # -----------------------------
    # 4) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    # -----------------------------
    col_names = list(df.columns)
    new_values = {}            # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    uploaded_image_file = None # ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)

    with st.form("edit_from_qr"):
        for i in range(0, len(col_names), 2):
            c1, c2 = st.columns(2)

            # ===== ‡∏ä‡πà‡∏≠‡∏á‡∏ã‡πâ‡∏≤‡∏¢ =====
            col_name1 = col_names[i]
            val1 = row.get(col_name1, "")
            if pd.isna(val1):
                val1 = ""

            with c1:
                if col_name1 == COL_IMAGE:
                    # ‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û: text + preview + uploader
                    new_values[col_name1] = st.text_input(
                        str(col_name1),
                        value=str(val1),
                        key=f"txt_{col_name1}_left",
                    )

                    # ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏° ‡∏ñ‡πâ‡∏≤ path ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
                    if str(val1).strip():
                        img_path = BASE_DIR / str(val1)
                        if img_path.exists():
                            st.image(
                                str(img_path),
                                caption="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
                                use_container_width=True,
                            )

                    uploaded = st.file_uploader(
                        "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà",
                        type=["png", "jpg", "jpeg"],
                        key="upload_image_left",
                    )
                    if uploaded is not None:
                        uploaded_image_file = uploaded
                        st.image(
                            uploaded,
                            caption="‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)",
                            use_container_width=True,
                        )
                        st.caption("‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'")
                else:
                    new_values[col_name1] = st.text_input(
                        str(col_name1),
                        value=str(val1),
                        key=f"txt_{col_name1}_left",
                    )

            # ===== ‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡∏ß‡∏≤ =====
            if i + 1 < len(col_names):
                col_name2 = col_names[i + 1]
                val2 = row.get(col_name2, "")
                if pd.isna(val2):
                    val2 = ""

                with c2:
                    if col_name2 == COL_IMAGE:
                        new_values[col_name2] = st.text_input(
                            str(col_name2),
                            value=str(val2),
                            key=f"txt_{col_name2}_right",
                        )

                        if str(val2).strip():
                            img_path = BASE_DIR / str(val2)
                            if img_path.exists():
                                st.image(
                                    str(img_path),
                                    caption="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
                                    use_container_width=True,
                                )

                        uploaded = st.file_uploader(
                            "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà",
                            type=["png", "jpg", "jpeg"],
                            key="upload_image_right",
                        )
                        if uploaded is not None:
                            uploaded_image_file = uploaded
                            st.image(
                                uploaded,
                                caption="‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)",
                                use_container_width=True,
                            )
                            st.caption("‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'")
                    else:
                        new_values[col_name2] = st.text_input(
                            str(col_name2),
                            value=str(val2),
                            key=f"txt_{col_name2}_right",
                        )

        submitted = st.form_submit_button("üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")

    # -----------------------------
    # 5) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö Excel
    # -----------------------------
    if submitted:
        try:
            # 5.1 ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏ã‡∏ü‡πÑ‡∏ü‡∏•‡πå + ‡πÅ‡∏Å‡πâ path ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
            if uploaded_image_file is not None:
                IMAGE_FOLDER.mkdir(exist_ok=True)
                suffix = Path(uploaded_image_file.name).suffix.lower()
                if suffix not in [".png", ".jpg", ".jpeg"]:
                    suffix = ".png"
                img_filename = f"{code}{suffix}"
                save_path = IMAGE_FOLDER / img_filename

                with open(save_path, "wb") as f:
                    f.write(uploaded_image_file.getbuffer())

                # ‡πÄ‡∏Å‡πá‡∏ö path ‡πÅ‡∏ö‡∏ö relative ‡∏•‡∏á‡πÉ‡∏ô Excel ‡πÄ‡∏ä‡πà‡∏ô asset_images/LAB-AS-001.png
                rel_path = save_path.relative_to(BASE_DIR)
                new_values[COL_IMAGE] = str(rel_path)

            # 5.2 ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô DataFrame ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ
            for col_name, val in new_values.items():
                df.at[row_idx, col_name] = val

            # 5.3 ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel
            save_data(df)

            st.success("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Excel ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚úÖ")
        except Exception as e:
            st.error(f"‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: {e}")

    st.markdown(
        "> ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `Smart Asset Lab.xlsx` ‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å QR "
        "‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' ‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel "
        "(‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á path ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢)"
    )

    return True


# ==============================
# 4) ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô (‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ code ‡πÉ‡∏ô URL)
# ==============================
def render_overview():
    st.markdown("## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Smart Asset QR")
    st.write(
        """
- ‡∏™‡πÅ‡∏Å‡∏ô QR ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ `?code=‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£`
- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ
- ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        """
    )
    st.info("‡∏•‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å URL ‡πÅ‡∏ö‡∏ö `...?code=LAB-AS-001` ‡∏î‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö")


# ==============================
# 5) main
# ==============================
def main():
    # ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ code ‡πÉ‡∏ô URL ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å QR
    shown = render_asset_from_query()
    # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ code ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ overview
    if not shown:
        render_overview()


if __name__ == "__main__":
    main()
